<!DOCTYPE html>
<html>

<head>
	<title>Sydney Street Art</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="utf-8">
	<link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">

</head>

<body onresize="orientation()" onload="get_data()" style="position:relative;overflow:hidden">


    <script>
        function get_data() {
            orientation();
            window.addEventListener("orientationchange", orientation(), false);
            
            var data_xml = new XMLHttpRequest();
            var graffiti_id=getQueryVariable("id");
            
            data_xml.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var graffitis=data_xml.responseXML.getElementsByTagName("graffiti");
                    graffiti=graffitis[graffiti_id];
                    
                    path=get_tag("full_path","");
                    date=get_tag("date","Unknown");
                    lat=get_tag("gps_lat","0.0");
                    lon=get_tag("gps_lon","0.0");
                    photo_by=get_tag("photographer","Unknown");                                
                    suburb=get_tag("suburb","Unknown");                                
                    title=get_tag("title","Graffiti #"+graffiti_id);
                    artist=get_tag("artist","Unknown");                    
                    status=get_tag("status","OK");
                    
                    artists=artist.split("/");
                    number_of_artists=artists.length;
                    artist_links=[];
                    for (var i=0;i<number_of_artists;i++) {
                        artist_links.push(get_tag("artist_link_"+(i+1),""));
                    }
                    
                    location_link='https://www.google.com/maps/embed/v1/place?key=AIzaSyC_BUk98XAiUAWE83JtAYyOgsXPG6uj3Jg&q='+lat+'%2C'+lon;
                    document.getElementById("map_frame").src=location_link;
                    document.getElementById("graffiti").src=path;
                    document.getElementById("data_title").innerHTML=title;
                    document.getElementById("data_suburb").innerHTML=suburb;
                    document.getElementById("data_date").innerHTML=date;
                    document.getElementById("data_photographer").innerHTML=photo_by;
                    
                    if (artist!="Unknown") {
                        for (var i=0;i<number_of_artists;i++) {
                            if (i==0) {document.getElementById("data_artist").innerHTML='<a href="'+artist_links[0]+'">'+artists[0]+'</a>';}
                            else {document.getElementById("data_artist").innerHTML=document.getElementById("data_artist").innerHTML+"&nbsp"+"&amp"+"&nbsp"+'<a href="'+artist_links[i]+'">'+artists[i]+'</a>';}
                        }
                    }
                    else {document.getElementById("data_artist").innerHTML="&nbsp"+"Unknown";}
                                       
                    if (status!="OK") {
                        document.getElementById("graffiti_data").innerHTML=document.getElementById("graffiti_data").innerHTML+'<tr><th style="text-align:right">Status:&nbsp</th><th style="text-align:left">&nbsp'+status+'</th></tr>';
                    }                                         
                };
            }
            data_xml.open("GET", "data/data.xml", true);
            data_xml.send();
		
	    function get_tag(tag_name,what_if_no_tag) {
            	temp=graffiti.getElementsByTagName(tag_name)[0].childNodes;
            	if (temp.length>0) {answer=temp[0].nodeValue;}
            	else {answer=what_if_no_tag;}
            	return(answer);
            }
        }		
			
	</script>
	<script>
		function getQueryVariable(variable)
		{
			var query = window.location.search.substring(1);
			var vars = query.split("&");
			for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
			}
			return(false);
		}
	</script>
    
	<script>
		function orientation() {
            if (window.innerHeight > 0.75*window.innerWidth) {
                document.getElementById("text_border").style="position:absolute;top:64%;left:1%;height:35%;width:48.5%;font-size:calc(1.1vh + 1.1vw);border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("graffiti_border").style="position:absolute;top:1%;left:1%;height:62%;width:98%;border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("single_graffiti_canvas").style="position:relative;top:1%;left:1%;height:98%;width:98%;";
                document.getElementById("map_border").style="position:absolute;top:64%;left:50.5%;height:35%;width:48.5%;border:0.4vmin solid white;border-radius:1vmin;";
			}
			else if (window.innerHeight > 0.25*window.innerWidth) {
				document.getElementById("text_border").style="position:absolute;top:1%;left:1%;height:48.5%;width:25%;font-size:calc(0.9vw + 1.1vh);border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("graffiti_border").style="position:absolute;top:1%;left:27%;height:98%;width:72%;border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("single_graffiti_canvas").style="position:relative;top:1%;left:1%;height:98%;width:98%;";
                document.getElementById("map_border").style="position:absolute;top:50.5%;left:1%;height:48.5%;width:25%;border:0.4vmin solid white;border-radius:1vmin;";                 
            }    
            else {
				document.getElementById("text_border").style="position:absolute;top:1%;left:1%;height:48.5%;width:25%;font-size:calc(4.5vh);border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("graffiti_border").style="position:absolute;top:1%;left:27%;height:98%;width:72%;border:0.4vmin solid white;border-radius:1vmin;";
                document.getElementById("single_graffiti_canvas").style="position:relative;top:1%;left:1%;height:98%;width:98%;";
                document.getElementById("map_border").style="position:absolute;top:50.5%;left:1%;height:48.5%;width:25%;border:0.4vmin solid white;border-radius:1vmin;";                 
            }
            if (document.getElementById("map_frame").src.substr(0,18)=='https://www.google'){
                    document.getElementById("map_frame").src=document.getElementById("map_frame").src;
            }               
        }
	</script>
    
    <div id="text_border" style="position:absolute;top:1%;left:1%;height:48.5%;width:25%;font-size:3vh;border:0.4vmin solid white;border-radius:1vmin;">
        <div id="text_canvas" style="width:100%;position:absolute;top:50%;transform:translate(0%,-50%);">
            <table id="graffiti_data" >
                <col width="33%">
                <col width="67%">
                <tr>
                    <th style="text-align:right">Title:&nbsp&nbsp</th><th style="text-align:center" id="data_title"></th>
                </tr>
                <tr>
                    <th style="text-align:right">Artist:&nbsp&nbsp</th><th style="text-align:center" id="data_artist"></th>
                </tr>
                <tr>
                    <th style="text-align:right">Suburb:&nbsp&nbsp</th><th style="text-align:center" id="data_suburb"></th>
                </tr>
                <tr>
                    <th style="text-align:right">Date:&nbsp&nbsp</th><th style="text-align:center" id="data_date"></th>
                </tr>
                <tr>
                    <th style="text-align:right">Photo by:&nbsp&nbsp</th><th style="text-align:center" id="data_photographer"></th>
                </tr>
            </table>
        </div>
    </div>
     
    <div  id="graffiti_border" style="position:absolute;top:1%;left:27%;height:98%;width:72%;font-size:3vh;border:0.4vmin solid white;border-radius:1vmin;">
        <div id="single_graffiti_canvas" class="centered_block" style="position:relative;top:1%;left:1%;height:98%;width:98%;">
            <img id="graffiti" src="" style="max-width:100%;max-height:100%;vertical-align:middle;width:auto;height:auto;border-radius:2vmin;display:inline-block;">      
        </div>
    </div>     


    <div id="map_border" style="position:absolute;top:50.5%;left:1%;height:48.5%;width:25%;font-size:3vh;border:0.4vmin solid white;border-radius:1vmin;">
        <div id="single_map_canvas" style="position:relative;top:1%;left:1%;height:98%;width:98%;">
                <iframe id="map_frame" src="about:blank" style="width:100%;height:100%;border:none;margin:0;">
                </iframe>
        </div>   
    </div>	
	
</body>
</html>

</body>
</html>
